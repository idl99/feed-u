<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed U - Payment Methods</title>

    <link rel="stylesheet" href="../css/base.css" />
    <script src=../bundle.js></script>

    <style>
        #payment-methods-list>.payment-methods-list-item>.payment-methods-list-item-title-container {
            display: flex;
            align-items: center;
        }

        #payment-methods-list>.payment-methods-list-item>.payment-methods-list-item-title-container>svg {
            margin-right: 20px;
        }
    </style>

</head>

<body>
    <div id="payment-methods" data-role="page" class="feedU-page ui-responsive-panel">
        <div id="payment-methods-header" data-role="header" data-toggle-on-tap="false" data-position="fixed"
            data-add-back-btn="true">
            <span class="ui-title"></span>
            <div data-enhance="false">
                <a href="home.html">
                    <img src="../assets/logo.png"></img>
                </a>
            </div>
        </div>
        <div role="main" class="ui-content" style="display: flex; flex-direction: column;">
            <h4>Payment Methods</h4>
            <a href="./add_new_payment_method.html" style="align-self: flex-end;">Add New</a>
            <div id="payment-methods-container">
                <ul data-role="listview" id="payment-methods-list" style="margin: 1em 0em;">
                    <li class="payment-methods-list-item">
                        <div class="payment-methods-list-item-title-container">
                            <svg width="22" height="18" viewBox="0 0 22 18" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M12.1 10.5H11.55V6.375C11.55 6.16781 11.4269 6 11.275 6H10.8082C10.6453 6 10.4861 6.06562 10.3507 6.18891L9.82369 6.66797C9.79363 6.69526 9.76782 6.73035 9.74771 6.77125C9.72761 6.81215 9.71362 6.85805 9.70653 6.90633C9.69944 6.9546 9.6994 7.00431 9.70641 7.05261C9.71342 7.10091 9.72734 7.14685 9.74738 7.18781L10.0526 7.81172C10.0726 7.8527 10.0984 7.88791 10.1284 7.91532C10.1584 7.94273 10.192 7.96181 10.2274 7.97148C10.2628 7.98114 10.2993 7.9812 10.3347 7.97164C10.3701 7.96208 10.4038 7.9431 10.4338 7.91578L10.45 7.90125V10.5H9.9C9.74806 10.5 9.625 10.6678 9.625 10.875V11.625C9.625 11.8322 9.74806 12 9.9 12H12.1C12.2519 12 12.375 11.8322 12.375 11.625V10.875C12.375 10.6678 12.2519 10.5 12.1 10.5ZM20.9 0H1.1C0.492594 0 0 0.671719 0 1.5V16.5C0 17.3283 0.492594 18 1.1 18H20.9C21.5074 18 22 17.3283 22 16.5V1.5C22 0.671719 21.5074 0 20.9 0ZM1.65 15.75V12.75C2.86516 12.75 3.85 14.093 3.85 15.75H1.65ZM1.65 5.25V2.25H3.85C3.85 3.90703 2.86516 5.25 1.65 5.25ZM11 14.25C9.17744 14.25 7.7 11.8992 7.7 9C7.7 6.10031 9.17744 3.75 11 3.75C12.8226 3.75 14.3 6.10031 14.3 9C14.3 11.9002 12.8219 14.25 11 14.25ZM20.35 15.75H18.15C18.15 14.093 19.1348 12.75 20.35 12.75V15.75ZM20.35 5.25C19.1348 5.25 18.15 3.90703 18.15 2.25H20.35V5.25Z"
                                    fill="#0FDA24" />
                            </svg>
                            <span>CASH</span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div id="payment-methods-footer" data-role="footer" data-toggle-on-tap="false" data-position="fixed"></div>
        <script>
            const { user, payment } = app;

            const PAYMENT_METHODS_CARDS_ICONS_SVG = {
                default:
                    `<svg width="22" height="24" viewBox="0 0 45 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.381592 36.9475C0.381592 39.3729 2.02592 41.3408 4.05264 41.3408H40.7632C42.7899 41.3408 44.4342 39.3729 44.4342 36.9475V20.8385H0.381592V36.9475ZM15.0658 30.7236C15.0658 30.1195 15.4788 29.6252 15.9836 29.6252H26.3849C26.8896 29.6252 27.3026 30.1195 27.3026 30.7236V34.3847C27.3026 34.9888 26.8896 35.483 26.3849 35.483H15.9836C15.4788 35.483 15.0658 34.9888 15.0658 34.3847V30.7236ZM5.27633 30.7236C5.27633 30.1195 5.68932 29.6252 6.19409 29.6252H11.7007C12.2054 29.6252 12.6184 30.1195 12.6184 30.7236V34.3847C12.6184 34.9888 12.2054 35.483 11.7007 35.483H6.19409C5.68932 35.483 5.27633 34.9888 5.27633 34.3847V30.7236ZM44.4342 4.72964V9.12298H0.381592V4.72964C0.381592 2.30415 2.02592 0.336304 4.05264 0.336304H40.7632C42.7899 0.336304 44.4342 2.30415 44.4342 4.72964Z" fill="#27AE60"/>
                    </svg>`,
                visa:
                    `<svg width="22" height="24" viewBox="0 0 45 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M36.0323 18.9769C36.0323 18.9769 36.6136 22.3817 36.7436 23.0956H34.1892C34.4415 22.281 35.4128 19.1142 35.4128 19.1142C35.3976 19.1416 35.6652 18.2813 35.8182 17.7504L36.0323 18.9769ZM44.1316 5.12869V37.3465C44.1316 39.772 42.4873 41.7399 40.4605 41.7399H3.75003C1.7233 41.7399 0.0789795 39.772 0.0789795 37.3465V5.12869C0.0789795 2.7032 1.7233 0.735352 3.75003 0.735352H40.4605C42.4873 0.735352 44.1316 2.7032 44.1316 5.12869ZM11.7422 28.1205L16.5758 13.9154H13.3254L10.3197 23.6173L9.99082 21.6495L8.92009 15.1144C8.74419 14.2083 8.20118 13.952 7.52815 13.9154H2.57988L2.52635 14.1991C3.73473 14.5652 4.81311 15.0961 5.75381 15.7642L8.49181 28.1205H11.7422ZM18.9619 28.1388L20.8893 13.9154H17.8147L15.8951 28.1388H18.9619ZM29.6615 23.4892C29.6768 21.8692 28.8508 20.6335 27.0842 19.6176C26.0058 18.9677 25.348 18.5284 25.348 17.8602C25.3633 17.2561 25.9064 16.6338 27.1147 16.6338C28.1166 16.6063 28.8508 16.89 29.4015 17.1738L29.6768 17.3294L30.0975 14.254C29.4933 13.9703 28.5296 13.6499 27.3442 13.6499C24.3079 13.6499 22.1741 15.5903 22.1588 18.3545C22.1359 20.3956 23.6884 21.5305 24.8509 22.217C26.0364 22.9126 26.4417 23.3702 26.4417 23.9834C26.4264 24.9353 25.4781 25.3747 24.5985 25.3747C23.3749 25.3747 22.7171 25.1459 21.7152 24.615L21.3099 24.3862L20.8816 27.5805C21.6005 27.9741 22.9313 28.3219 24.3079 28.3402C27.5354 28.3493 29.6386 26.4364 29.6615 23.4892ZM40.4605 28.1388L37.9826 13.9154H35.604C34.8698 13.9154 34.3115 14.1717 33.998 15.0961L29.4321 28.1388H32.6596C32.6596 28.1388 33.1873 26.3815 33.302 26.0062H37.2484C37.3402 26.5096 37.6155 28.1388 37.6155 28.1388H40.4605Z" fill="#2D9CDB"/>
                    </svg>`,
                mastercard:
                    `<svg width="22" height="24" viewBox="0 0 38 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0)">
                            <path d="M31.5087 32.8561C31.5087 33.4006 31.2085 33.793 30.7779 33.793C30.3342 33.793 30.0471 33.3766 30.0471 32.8561C30.0471 32.3355 30.3342 31.9191 30.7779 31.9191C31.2085 31.9191 31.5087 32.3355 31.5087 32.8561ZM11.2293 31.9191C10.7661 31.9191 10.4985 32.3355 10.4985 32.8561C10.4985 33.3766 10.7661 33.793 11.2293 33.793C11.6534 33.793 11.9405 33.4006 11.9405 32.8561C11.934 32.3355 11.6534 31.9191 11.2293 31.9191ZM18.8961 31.8951C18.5437 31.8951 18.3284 32.1754 18.2762 32.5918H19.5225C19.4637 32.1354 19.2354 31.8951 18.8961 31.8951ZM25.9299 31.9191C25.4862 31.9191 25.2187 32.3355 25.2187 32.8561C25.2187 33.3766 25.4862 33.793 25.9299 33.793C26.3736 33.793 26.6607 33.4006 26.6607 32.8561C26.6607 32.3355 26.3736 31.9191 25.9299 31.9191ZM32.8397 34.0092C32.8397 34.0332 32.8593 34.0492 32.8593 34.0973C32.8593 34.1213 32.8397 34.1373 32.8397 34.1854C32.8202 34.2094 32.8202 34.2254 32.8071 34.2494C32.7875 34.2734 32.7745 34.2895 32.7353 34.2895C32.7158 34.3135 32.7027 34.3135 32.6636 34.3135C32.644 34.3135 32.6309 34.3135 32.5918 34.2895C32.5722 34.2895 32.5592 34.2654 32.5396 34.2494C32.52 34.2254 32.507 34.2094 32.507 34.1854C32.4874 34.1453 32.4874 34.1213 32.4874 34.0973C32.4874 34.0572 32.4874 34.0332 32.507 34.0092C32.507 33.9691 32.5265 33.9451 32.5396 33.9211C32.5592 33.8971 32.5722 33.8971 32.5918 33.8811C32.6244 33.857 32.644 33.857 32.6636 33.857C32.6962 33.857 32.7158 33.857 32.7353 33.8811C32.768 33.9051 32.7875 33.9051 32.8071 33.9211C32.8267 33.9371 32.8202 33.9691 32.8397 34.0092ZM32.6962 34.1213C32.7288 34.1213 32.7288 34.0973 32.7484 34.0973C32.768 34.0732 32.768 34.0572 32.768 34.0332C32.768 34.0092 32.768 33.9932 32.7484 33.9691C32.7288 33.9691 32.7158 33.9451 32.6766 33.9451H32.5722V34.2254H32.6244V34.1133H32.644L32.7158 34.2254H32.768L32.6962 34.1213V34.1213ZM37.5833 6.48633V34.6738C37.5833 36.7959 36.1805 38.5176 34.4514 38.5176H3.13194C1.40285 38.5176 0 36.7959 0 34.6738V6.48633C0 4.36426 1.40285 2.64258 3.13194 2.64258H34.4514C36.1805 2.64258 37.5833 4.36426 37.5833 6.48633ZM4.17593 17.6652C4.17593 23.7912 8.22788 28.7561 13.2129 28.7561C14.9877 28.7561 16.7298 28.0994 18.2044 26.9062C13.4478 22.1576 13.4804 13.1969 18.2044 8.44824C16.7298 7.24707 14.9877 6.59844 13.2129 6.59844C8.22788 6.59043 4.17593 11.5633 4.17593 17.6652ZM18.7917 26.3777C23.3917 21.9734 23.3721 13.3891 18.7917 8.96074C14.2112 13.3891 14.1916 21.9814 18.7917 26.3777ZM9.50676 32.4877C9.50676 31.791 9.13484 31.3346 8.5476 31.3105C8.24745 31.3105 7.92773 31.4227 7.71241 31.8311C7.55582 31.5027 7.2883 31.3105 6.91638 31.3105C6.66843 31.3105 6.42049 31.4227 6.22474 31.743V31.3906H5.6897V34.3295H6.22474C6.22474 32.816 6.06162 31.9111 6.81198 31.9111C7.47752 31.9111 7.34702 32.7279 7.34702 34.3295H7.86248C7.86248 32.8641 7.69936 31.9111 8.44973 31.9111C9.11526 31.9111 8.98477 32.7119 8.98477 34.3295H9.5198V32.4877H9.50676ZM12.4364 31.3906H11.921V31.743C11.7448 31.4787 11.4968 31.3105 11.1576 31.3105C10.4855 31.3105 9.97002 31.9672 9.97002 32.8561C9.97002 33.7529 10.4855 34.4016 11.1576 34.4016C11.4968 34.4016 11.7448 34.2494 11.921 33.9691V34.3375H12.4364V31.3906ZM15.079 33.4406C15.079 32.2395 13.5848 32.784 13.5848 32.2234C13.5848 31.767 14.3613 31.8391 14.7919 32.1354L15.0072 31.6148C14.3939 31.1264 13.0367 31.1344 13.0367 32.2715C13.0367 33.4166 14.5309 32.9361 14.5309 33.4727C14.5309 33.9771 13.6501 33.9371 13.1803 33.5367L12.9519 34.0412C13.6827 34.6498 15.079 34.5217 15.079 33.4406V33.4406ZM17.3888 34.1854L17.2453 33.6408C16.9973 33.809 16.4492 33.9932 16.4492 33.3125V31.9832H17.304V31.3906H16.4492V30.4937H15.9142V31.3906H15.4183V31.9752H15.9142V33.3125C15.9142 34.7219 17.043 34.4656 17.3888 34.1854V34.1854ZM18.2566 33.1123H20.051C20.051 31.815 19.5681 31.3025 18.9156 31.3025C18.224 31.3025 17.7281 31.9352 17.7281 32.848C17.7281 34.4896 19.2027 34.7619 19.9335 33.9852L19.6856 33.5047C19.1766 34.0172 18.4067 33.9691 18.2566 33.1123V33.1123ZM22.1128 31.3906C21.8127 31.2305 21.3559 31.2465 21.121 31.743V31.3906H20.586V34.3295H21.121V32.6719C21.121 31.743 21.7409 31.8631 21.9562 31.9992L22.1128 31.3906V31.3906ZM22.8045 32.8561C22.8045 31.9432 23.5614 31.6469 24.1551 32.1834L24.4031 31.6629C23.6462 30.9342 22.2694 31.3346 22.2694 32.8641C22.2694 34.4496 23.731 34.7699 24.4031 34.0652L24.1551 33.5447C23.5548 34.0652 22.8045 33.7529 22.8045 32.8561ZM27.1566 31.3906H26.6215V31.743C26.08 30.8621 24.6706 31.3586 24.6706 32.8561C24.6706 34.3936 26.1322 34.834 26.6215 33.9691V34.3375H27.1566V31.3906V31.3906ZM29.3555 31.3906C29.1989 31.2945 28.6377 31.1584 28.3637 31.743V31.3906H27.8482V34.3295H28.3637V32.6719C28.3637 31.791 28.9509 31.8471 29.1989 31.9992L29.3555 31.3906V31.3906ZM31.985 30.1975H31.4695V31.743C30.9345 30.8701 29.5186 31.3346 29.5186 32.8561C29.5186 34.4096 30.9867 34.826 31.4695 33.9691V34.3375H31.985V30.1975ZM32.4809 24.1836V24.552H32.5331V24.1836H32.657V24.1195H32.3569V24.1836H32.4809V24.1836ZM32.9115 34.0973C32.9115 34.0572 32.9115 34.0092 32.8919 33.9691C32.8724 33.9451 32.8593 33.9051 32.8397 33.8811C32.8202 33.857 32.7875 33.841 32.768 33.817C32.7353 33.817 32.6962 33.793 32.6636 33.793C32.644 33.793 32.6114 33.817 32.5722 33.817C32.5396 33.841 32.52 33.857 32.5004 33.8811C32.4678 33.9051 32.4482 33.9451 32.4482 33.9691C32.4287 34.0092 32.4287 34.0572 32.4287 34.0973C32.4287 34.1213 32.4287 34.1613 32.4482 34.2094C32.4482 34.2334 32.4678 34.2734 32.5004 34.2975C32.52 34.3215 32.5331 34.3375 32.5722 34.3615C32.6048 34.3855 32.644 34.3855 32.6636 34.3855C32.6962 34.3855 32.7353 34.3855 32.768 34.3615C32.7875 34.3375 32.8202 34.3215 32.8397 34.2975C32.8593 34.2734 32.8724 34.2334 32.8919 34.2094C32.9115 34.1613 32.9115 34.1213 32.9115 34.0973ZM33.1203 24.1115H33.029L32.9246 24.3918L32.8202 24.1115H32.7288V24.5439H32.781V24.2156L32.8854 24.4959H32.9572L33.0485 24.2156V24.5439H33.1203V24.1115V24.1115ZM33.4074 17.6652C33.4074 11.5633 29.3555 6.59043 24.3704 6.59043C22.5957 6.59043 20.8535 7.24707 19.3789 8.44023C24.0833 13.1889 24.1551 22.1736 19.3789 26.8982C20.8535 28.0994 22.6087 28.748 24.3704 28.748C29.3555 28.7561 33.4074 23.7912 33.4074 17.6652V17.6652Z" fill="#FF5F00"/>
                        </g>
                        <defs>
                            <clipPath id="clip0">
                            <rect width="37.5833" height="41" fill="white"/>
                            </clipPath>
                        </defs>
                    </svg>`,
            }

            const pointsCard = $(`<li class="payment-methods-list-item">
                        <div class="payment-methods-list-item-title-container">
                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M0 18.9984V21C0 22.6547 3.69531 24 8.25 24C12.8047 24 16.5 22.6547 16.5 21V18.9984C14.7254 20.3625 11.4812 21 8.25 21C5.01875 21 1.77461 20.3625 0 18.9984ZM13.75 6C18.3047 6 22 4.65469 22 3C22 1.34531 18.3047 0 13.75 0C9.19531 0 5.5 1.34531 5.5 3C5.5 4.65469 9.19531 6 13.75 6ZM0 14.0812V16.5C0 18.1547 3.69531 19.5 8.25 19.5C12.8047 19.5 16.5 18.1547 16.5 16.5V14.0812C14.7254 15.675 11.477 16.5 8.25 16.5C5.02305 16.5 1.77461 15.675 0 14.0812ZM17.875 14.5969C20.3371 14.0766 22 13.1109 22 12V9.99844C21.0031 10.7672 19.5379 11.2922 17.875 11.6156V14.5969ZM8.25 7.5C3.69531 7.5 0 9.17813 0 11.25C0 13.3219 3.69531 15 8.25 15C12.8047 15 16.5 13.3219 16.5 11.25C16.5 9.17813 12.8047 7.5 8.25 7.5ZM17.673 10.1391C20.2512 9.63281 22 8.63906 22 7.5V5.49844C20.4746 6.675 17.8535 7.30781 15.0949 7.45781C16.3625 8.12813 17.2949 9.02812 17.673 10.1391Z"
                                    fill="#F2C94C" />
                            </svg>
                            <span>POINTS (${parseFloat(user.getDetails().profile.points).toFixed(2)})</span>
                        </div>
                    </li>`)

            $('#payment-methods-list').append(pointsCard);

            var getCardMarkup = (id, brand, last4digits) => {
                return `<li class="payment-methods-list-item">
                            <div payment-method-id="${id}" class="payment-methods-list-item-title-container">
                                ${PAYMENT_METHODS_CARDS_ICONS_SVG[brand] || PAYMENT_METHODS_CARDS_ICONS_SVG['default']}
                                <span>**** ${last4digits}</span>
                                <div class="ui-btn-icon-right ui-icon-minus payment-methods-remove-card-btn"></div>
                            </div > 
                        </li>`;
            }

            const renderCards = (response) => {
                const { data } = response;

                data.forEach(({ id, card }) => {
                    const markup = getCardMarkup(id, card.brand, card.last4);
                    $("#payment-methods-list").append(markup)
                });

                // Refresh the list view so that jQuery Mobile can add enhancements
                // to the newly added list views elmements
                $('#payment-methods-list').listview("refresh");

                $('.payment-methods-remove-card-btn').click(function () {
                    const cardElement = $(this);
                    const cardId = cardElement.parent().attr("payment-method-id");
                    payment.removeCard(cardId, (response) => {
                        cardElement.parent().parent().remove();
                    }, () => { })
                })
            }

            payment.getAllCardsForCustomer(renderCards, () => { })
        </script>

    </div>
</body>

</html>