<!DOCTYPE html>
<html>

<head>
    <title>QR Code Scanner</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="stylesheet" href="../css/base.css" />
    <script src="../bundle.js"></script>
</head>

<body>

    <style>
        html {
            height: 100%;
        }

        body {
            font-family: sans-serif;
            padding: 0 10px;
            height: 100%;
            background: black;
            margin: 0;
        }

        h1 {
            color: white;
            margin: 0;
            padding: 15px;
        }

        #container {
            text-align: center;
            margin: 0;
        }

        #qr-canvas {
            margin: auto;
            width: calc(100% - 20px);
            max-width: 400px;
        }

        #btn-scan-qr {
            cursor: pointer;
        }

        #btn-scan-qr img {
            height: 10em;
            padding: 15px;
            margin: 15px;
            background: white;
        }

        /* #qr-result {
            font-size: 1.2em;
            margin: 20px auto;
            padding: 20px;
            max-width: 700px;
            background-color: white;
        } */

        /* CSS for the pre-defined scanned QR page starts here */

        .coupon {
            border: 5px dotted #bbb;
            /* Dotted border */
            width: 30%;
            border-radius: 15px;
            /* Rounded border */
            margin: 0 auto;
            /* Center the coupon */
            /* max-width: 600px; */
        }

        .container {
            padding: 2px 16px;
            background-color: #f1f1f1;
            text-align: center;
        }

        .promo {
            background: #ccc;
            padding: 3px;
        }

        .expire {
            color: red;
        }

        .header {
            text-align: center;
        }

        .brand-name {
            font-size: 20px;
        }
    </style>

    <div data-role="page" id="qr-scanner-page">
        <div class="ui-content">
            <div id="container">
                <h1>QR Code Scanner</h1>

                <a id="btn-scan-qr">
                    <img src="https://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2017/07/1499401426qr_icon.svg">
                    <a />

                    <canvas hidden="" id="qr-canvas"></canvas>

                    <div id="qr-result" hidden="">
                        <!-- <b>Dzata:</b> <span id="outputData"></span> -->
                        <div class="coupon" data-dismissible="false" data-role="popup">
                            <div class="container header">
                                <div>
                                    <span>
                                        <a data-transition="pop" onclick="doSomething()"
                                            class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-btn-icon-notext ui-btn-right"
                                            style="position: absolute; margin: 10px 10px 0 0; text-decoration: none; cursor: pointer">&times</a>
                                    </span>
                                </div>
                                <h3 class="brand-name">FeedU</h3>
                                <img src="../assets/images/qr-result.PNG" alt="Avatar"
                                    style="width:25%;">
                            </div>
                            <!-- C:/Users/Acer/Documents/Mobile UI-UX/qr-result.png -->
                            <div style="text-align: center; background-color: white;">
                                <img src="../assets/images/undraw_gift_card.svg" alt="Avatar"
                                    style="width:40%;">
                            </div>
                            <div class="container" style="background-color:white; text-align: center;">
                                <h2><b>CONGRATULATIONS</b></h2>
                                <p>YOU JUST W0N A 30% OFF YOUR PURCHASE</p>
                            </div>
                            <div class="container">
                                <p>Use Promo Code: <span class="promo">BOH232</span></p>
                                <p class="expire">Expires: Feb 03, 2021</p>
                            </div>
                        </div>
                    </div>
            </div>
            <script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
            <script>
                const myQRCode = window.qrcode;

                const video = document.createElement("video");
                const canvasElement = document.getElementById("qr-canvas");
                const canvas = canvasElement.getContext("2d");

                const qrResult = document.getElementById("qr-result");
                // const outputData = document.getElementById("outputData");
                const btnScanQR = document.getElementById("btn-scan-qr");

                let scanning = false;

                qrcode.callback = res => {
                    if (res) {
                        // if (document.getElementById("qr-popup").style.display != "none") {
                        //     document.getElementById("qr-popup").style.display = "none";
                        // } else if (document.getElementById("qr-popup").style.display == "none") {
                        //     document.getElementById("qr-popup").style.display = "block"
                        // }
                        // document.getElementById("qr-popup").style.visibility = "visible";
                        // outputData.innerText = res;
                        scanning = false;

                        video.srcObject.getTracks().forEach(track => {
                            track.stop();
                        });

                        qrResult.hidden = false;
                        canvasElement.hidden = true;
                        btnScanQR.hidden = false;
                    }
                };

                btnScanQR.onclick = () => {
                    navigator.mediaDevices
                        .getUserMedia({
                            video: {
                                facingMode: "environment"
                            }
                        })
                        .then(function (stream) {
                            scanning = true;
                            qrResult.hidden = true;
                            btnScanQR.hidden = true;
                            canvasElement.hidden = false;
                            video.setAttribute("playsinline",
                                true); // required to tell iOS safari we don't want fullscreen
                            video.srcObject = stream;
                            video.play();
                            tick();
                            scan();
                        });
                };

                function tick() {
                    canvasElement.height = video.videoHeight;
                    canvasElement.width = video.videoWidth;
                    canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);

                    scanning && requestAnimationFrame(tick);
                }

                function scan() {
                    try {
                        qrcode.decode();
                    } catch (e) {
                        setTimeout(scan, 300);
                    }
                }

                function doSomething() {
                    console.log("Hey");
                    window.history.back();
                }
            </script>
        </div>
    </div>


</body>
<!-- mark-up for the pre-defined scanned QR page starts here -->
<!-- <div style="display: none;" id="qr-popup">
    <div class="coupon">
        <div class="container header">
            <h3 class="brand-name">FeedU</h3>
            <img src="C:/Users/Acer/Documents/Mobile UI-UX/colored-bg.png" alt="Avatar" style="width:25%;">
        </div>
        <div style="text-align: center; background-color: white;">
            <img src="C:/Users/Acer/Documents/Mobile UI-UX/undraw_gift_card.svg" alt="Avatar" style="width:40%;">
        </div>
        <div class="container" style="background-color:white; text-align: center;">
            <h2><b>CONGRATULATIONS</b></h2>
            <p>YOU JUST W0N A 30% OFF YOUR PURCHASE</p>
            <p>*insert photo*</p>
        </div>
        <div class="container">
            <p>Use Promo Code: <span class="promo">BOH232</span></p>
            <p class="expire">Expires: Feb 03, 2021</p>
        </div>
    </div>
</div> -->

</html>