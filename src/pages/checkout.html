<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed U - Checkout</title>

    <link rel="stylesheet" href="../css/base.css" />
    <script src="../bundle.js"></script>
</head>

<body>
    <div data-role="page" id="checkout">
        <div data-role="header" id="checkout-header" data-add-back-btn="true" data-position="fixed"
            data-tap-toggle="false">
            <h4>Header</h4>
        </div>
        <div class="ui-content" data-fullscreen="true">
            <div id="checkout-restaurant-details-container">
                <div id="checkout-restaurant-name">Restaurant Name</div>
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <span style="margin-right: 5px;">Deliver Now | </span>
                    <!-- 
                        https://css-tricks.com/flexbox-truncated-text/ 
                        TODO fix for longer display names
                    -->
                    <span id="checkout-delivery-location"
                        style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                        Delivery Location </span>
                    <a href="index.html" class="ui-btn ui-shadow ui-corner-all ui-icon-navigation ui-btn-icon-notext"
                        style="margin-left: 5px;"></a>
                </div>
                <div id="checkout-eta">ETA</div>
                <div id="checkout-payment-method-container"> Payment Details </div>
            </div>

            <hr style="margin: 5vh 0vw" />

            <div id="checkout-order-summary">
                <span style="text-align: center;"> Your Order </span>
                <a href="#" style="margin: 2vh 0vw; text-align: right;">View Menu</a>

                <div id="checkout-items-grid">
                </div>
            </div>
        </div>
        <div data-role="footer" class="checkout-footer" data-position="fixed">
            <h4>Footer</h4>
        </div>

        <script>
            // The code below uses ES6 syntax since modern browsers support it (Chrome / Edge versions released after 2016)
            // Refer https://www.w3schools.com/js/js_versions.asp for more
            const { user, cart } = app;
            const summary = cart.summary();

            $("#checkout-restaurant-name").text(summary.vendor.vendorName);
            $("#checkout-eta").text(summary.vendor.deliveryTime);
            $("#checkout-delivery-location").text(user.getDetails().location.display);


            var items = new Array(5).fill([...summary.items]).flat() || []; // TODO refactor this once mock data is removed

            // Calculate bill total
            var billTotal = items.reduce((sum, { itemPrice }) => {
                return sum + itemPrice;
            }, 0);
            var paymentMethod = 'CASH' // TODO replace
            $("#checkout-payment-method-container").text(`Paying ${billTotal} By ${paymentMethod}`);

            // render items in order summary
            items.forEach(({ quantity, itemName, itemPrice }) => {
                var markup =
                    `<div class="checkout-item">
                        <div class="checkout-item-quantity">${quantity} X </div>
                        <div class="checkout-item-name">${itemName}</div>
                        <div class="checkout-item-price">${itemPrice}</div>
                    </div>`;
                $('#checkout-items-grid').append(markup)
            });

        </script>
    </div>
</body>

</html>